10  REM     *********************************
20  REM     *                               *
30  REM     *    SIMULADORR   ' S I M U '   *
40  REM     *                               *
50  REM     *********************************
60  REM
70  REM ** SIMULA UM COMPUTADOR OPERANDO EM DOS **
80  REM ** ACEITA PROGRAMAS ESCRITOS EM ASSSEMBLER **
90  REM ** AUTOR - SEBASTIAO SANTIAGO BARRETTO **
100  REM ** VERSAO 1 * LSD-EPUSP-DEE * 28/9/73 **
110  DEF FNA(X)=INT((X+3)/4)
120  DEF FNB(X)=X-INT((X-1)/4)*4
130  DIM A$[30],B$[30],C$[10],D$[31],E$[30],F$[30]
140  DIM A[401],X[9]
150  FILES A,B
160  B0=W=T=0
170  A1=1
180  MAT A=ZER
190  C$="0123456789"
200  DATA "TA","FI","CA","CH","GU","MU","LI","PE","EX","CO"
210  DATA "CAX","MDX","SOX","SUX","MUX","DIX","ARX"
220  DATA "CAR","ARM","SOM","SUB","MUL","DIV","IMP","IML"
230  DATA "LE ","MDM","DAI","PAR","DC ","NOP","MAD","MAE"
240  DATA "DZ ","DP ","DN ","DO ","D  ","DM ","BIB"
250  DATA "IS ","ABS","EXP","LOG","INT","SQR","RND","SIN","COS","ATN"
260  PRINT "@";
270  INPUT A$
280  IF A$[1,1]=":" THEN 310
290  PRINT "???"
300  GOTO 260
310  FOR I=1 TO 10
320  IF T#0 OR I<3 THEN 350
330  PRINT "IGNORADO"
340  GOTO 460
350  READ B$
360  IF A$[2,3]=B$ THEN 400
370  NEXT I
380  PRINT "COMANDO INCORRETO ; REENTRE-O"
390  GOTO 460
400  K2=3
410  GOSUB 4210
420  IF I<5 OR W#0 THEN 450
430  PRINT "NAO EXISTE NENHUM PROGRAMA"
440  GOTO 460
450  GOSUB I OF 480,4280,510,4020,3960,3260,3080,3030,1480,710
460  RESTORE 
470  GOTO 260
480  T=1
490  PRINT "TAREFA"
500  RETURN 
510  PRINT #1,1
520  W=0
530  INPUT D$[1,31]
540  IF D$[1,1]#"'" THEN 560
550  D$[1,30]=D$[2,31]
560  IF W<360 THEN 590
570  PRINT "PROGRAMA MUITO LONGO"
580  RETURN 
590  PRINT #1;D$[1,30]
600  W=W+1
610  IF D$[5,7]#"FIM" THEN 530
620  IF FNB(W)=4 THEN 700
630  FOR I=FNB(W) TO 3
640  PRINT #1;D$[1,30]
650  NEXT I
660  PRINT 
670  M7=W
680  GOSUB 3914
690  PRINT "LINHAS"
700  RETURN 
710  B0=I2=1
720  FOR I=1 TO W-1
730  READ #1,FNA(I)
740  FOR K=1 TO FNB(I)
750  READ #1;B$
760  NEXT K
770  J=L=0
780  IF B$[1,1]="*" THEN 1420
790  IF B$[5,7]="DC " THEN 1120
800  IF B$[5,7]#"BLC" THEN 870
810  G=11
820  GOSUB 4090
830  FOR I2=I2 TO I2+C
840  A[A]=0
850  NEXT I2
860  GOTO 1420
870  FOR J=1 TO 30
880  READ A$
890  IF A$=B$[5,7] THEN 950
900  NEXT J
910  C0=1
920  PRINT "ERRO";C0;"NA INSTRUCAO";I
930  B0=J=0
940  GOTO 1370
950  IF J#29 THEN 980
960  J=I
970  GOTO 1370
980  IF J#30 THEN 1060
990  FOR L=1 TO 10
1000  READ A$
1010  IF B$[12,14]=A$ THEN 1370
1020  NEXT L
1030  L=0
1040  C0=3
1050  GOTO 920
1060  FOR B=2 TO 10
1070  IF B$[10,10]=C$[B,B] THEN 1120
1080  NEXT B
1090  B=1
1100  C0=4
1110  IF J<8 THEN 920
1120  G=12
1130  X=31
1140  V=-1
1150  IF B$[G,G]="-" THEN 1180
1160  V=1
1170  IF B$[G,G]#"+" THEN 1230
1180  GOSUB 4090
1190  L=C*V
1200  IF X>H THEN 1370
1210  L=L/10^(H-X)
1220  GOTO 1370
1230  IF B$[12,14]="   " THEN 1370
1240  READ #1,1
1250  FOR L1=1 TO W-1
1260  READ #1;A$
1270  IF A$[1,1]="*" THEN 1340
1280  L=L+1
1290  IF A$[1,3]=B$[12,14] THEN 1370
1300  IF A$[5,7]#"BLC" THEN 1340
1310  G=1
1320  GOSUB 4090
1330  L=L+C-1
1340  NEXT L1
1350  C0=2
1360  GOTO 920
1370  A[I2]=10000*J+1000*(B-1)+L
1380  IF B$[9,9]#"I" THEN 1400
1390  A[I2]=-A[I2]
1400  RESTORE 210
1410  I2=I2+1
1420  NEXT I
1430  U=I2
1440  IF B0=0 THEN 1460
1450  PRINT "NENHUM ERRO"
1460  PRINT "FIM DA COMPILACAO"
1470  RETURN 
1480  IF B0=1 THEN 1530
1490  PRINT "EXECUCAO IMPOSSIVEL"
1500  RETURN 
1510  E0=2
1520  GOTO 1650
1530  A=O=X8=0
1540  MAT X=ZER
1550  I1=1
1560  C=120
1570  IF K2=1 THEN 1630
1580  IF A$[K2,K2]#"T" THEN 1620
1590  X8=1
1600  GOSUB 4210
1610  IF K2=1 THEN 1630
1620  GOSUB 4090
1630  IF I1 <= U AND I1>0 THEN 1690
1640  E0=1
1650  PRINT "ERRO";E0;"EXECUCAO SUSPENSA"
1660  RETURN 
1670  PRINT "FIM DA EXECUCAO"
1680  RETURN 
1690  A2=ABS(A[I1])
1700  A5=INT(A2/10000)
1710  I5=INT(A2/1000-10*A5)
1720  B=A2-A5*10000-I5*1000
1730  IF I5=0 OR A5<8 THEN 1550
1740  B=B+X[I5]
1750  IF B<1 OR B>U THEN 1640
1760  B=A[B]
1770  PRINT "AC=";A;"IAR=";I1;"OV=";O
1780  GOTO A5 OF 2420,2460,1910,1910,1910,1910
1790  IF B<1 OR B>U THEN 1820
1800  GOTO A5-6 OF 2440,1940,1960,2110,2150,2320
1810  GOTO A5-12 OF 2360,2190,2210,2230,2250,2290
1820  GOTO A5-18 OF 1670,1510,1860,2530,2580,1980
1830  GOTO A5-24 OF 2010,2040,2070,2050,2630,2780
1840  IF A5>30 OR A5<1 THEN 1510
1850  GOTO 1640
1860  I1=I1+1
1870  C=C-.01
1880  IF C>0 THEN 1630
1890  PRINT "ULTRAPASSOU O LIMITE DE TEMPO"
1900  RETURN 
1910  B=401
1920  A[401]=X[I5]
1930  GOTO A5-2 OF 2110,2150,2320,2360
1940  A=A[B]
1950  GOTO 1860
1960  A[B]=A
1970  GOTO 1860
1980  IF A#0 THEN 1860
1990  I1=B-1
2000  GOTO 1860
2010  IF A <= 0 THEN 1860
2020  I1=B-1
2030  GOTO 1860
2040  IF A >= 0 THEN 1860
2050  I1=B-1
2060  GOTO 1860
2070  IF O=0 THEN 1860
2080  I1=B-1
2090  O=0
2100  GOTO 1860
2110  A=A+A[B]
2120  IF ABS(A)<10^7 THEN 2090
2130  O=1
2140  GOTO 1860
2150  A=A-A[B]
2160  GOTO 2120
2170  O=1
2180  GOTO 1860
2190  PRINT A[B]
2200  GOTO 1860
2210  PRINT A[B];
2220  GOTO 1860
2230  INPUT A[B]
2240  GOTO 1860
2250  A[B]=A[B]-1
2260  IF A[B]#0 THEN 1860
2270  I1=I1+1
2280  GOTO 1860
2290  A[B]=I1+1
2300  I1=B
2310  GOTO 1860
2320  A=A*A[B]
2330  GOTO 2120
2340  O=1
2350  GOTO 1860
2360  IF A[B]#0 THEN 2400
2370  A=SGN(A)*10^38
2380  PRINT "DIVISAO POR ZERO"
2390  GOTO 2130
2400  A=A/A[B]
2410  GOTO 2120
2420  X[I5]=B
2430  GOTO 1860
2440  A[B]=X[I5]
2450  GOTO 1860
2460  L6=X[I5]+B
2470  IF X[I5]=0 OR SGN(X[I5])=SGN(L6) THEN 2490
2480  I1=I1+1
2490  X[I5]=L6
2500  GOTO 1860
2510  A=-A
2520  GOTO 1860
2530  IF B <= 0 THEN 1860
2540  FOR F2=1 TO B
2550  A=INT(A/10)
2560  NEXT F2
2570  GOTO 1860
2580  IF B <= 0 THEN 1860
2590  FOR F2=1 TO B
2600  A=10*(A-INT(A/100000.)*100000.)
2610  NEXT F2
2620  GOTO 1860
2630  READ #1,FNA(B);A$,B$,E$,F$
2640  GOTO FNB(B) OF 2680,2670,2660,2650
2650  E$=F$
2660  B$=E$
2670  A$=B$
2680  FOR K7=12 TO 30
2690  C=C-.1
2700  IF A$[K7,K7]#"'" THEN 2750
2710  IF K7=30 THEN 1860
2720  IF A$[K7+1,K7+1]#"'" THEN 1860
2730  PRINT 
2740  GOTO 1860
2750  PRINT A$[K7,K7];
2760  NEXT K7
2770  GOTO 1860
2780  GOTO B OF 2810,2830,2850,2870,2910,2930,2970,2990,3010
2790  A=ATN(A)
2800  GOTO 1860
2810  A=-A
2820  GOTO 1860
2830  A=ABS(A)
2840  GOTO 1860
2850  A=EXP(A)
2860  GOTO 1860
2870  E0=3
2880  IF A <= 0 THEN 1650
2890  A=LOG(A)
2900  GOTO 1860
2910  A=INT(A)
2920  GOTO 1860
2930  E0=4
2940  IF A<0 THEN 1650
2950  A=SQR(A)
2960  GOTO 1860
2970  A=RND(0)
2980  GOTO 1860
2990  A=SIN(A)
3000  GOTO 1860
3010  A=COS(A)
3020  GOTO 1860
3030  PRINT ""
3040  FOR S5=1 TO 1000
3050  NEXT S5
3060  R3=0
3070  GOTO 3100
3080  PRINT ""
3090  R3=1
3100  READ #1,1
3110  FOR M7=1 TO W
3120  READ #1;A$
3130  IF R3=1 THEN 3170
3140  IF A$[1,1]#" " THEN 3180
3150  PRINT "'";
3160  GOTO 3180
3170  PRINT "LINHA";M7;
3180  FOR F=30 TO 1 STEP -1
3190  IF A$[F,F]#" " THEN 3210
3200  NEXT F
3210  PRINT A$[1,F]
3220  NEXT M7
3230  PRINT ""
3240  RETURN 
3250  PRINT "???"
3260  H=0
3270  PRINT "*";
3280  INPUT B$[1,30]
3290  IF B$[1,1]="/" THEN 3310
3300  IF H=1 THEN 3610
3310  IF B$[2,2]#"F" THEN 3330
3320  RETURN 
3330  H=1
3340  IF B$[2,2]="I" THEN 3580
3350  H=2
3360  IF B$[2,2]="S" THEN 3530
3370  IF B$[2,2]#"A" THEN 3250
3380  INPUT S
3390  G1=FNB(S)
3400  FOR K=FNA(S) TO FNA(W)
3410  READ #1,K;A$,B$,D$,E$
3420  IF K=90 THEN 570
3430  READ #1;F$
3440  GOTO G1 OF 3480,3470,3460
3450  E$=D$
3460  D$=B$
3470  B$=A$
3480  PRINT #1,K;B$,D$,E$,F$
3490  G1=1
3500  NEXT K
3510  W=W-1
3520  GOTO 3260
3530  INPUT S
3540  PRINT "*";
3550  INPUT A$[1,30]
3560  GOSUB 3850
3570  GOTO 3270
3580  INPUT X1
3590  PRINT "*";
3600  INPUT B$[1,30]
3610  S=FNB(X1)
3620  W=W+1
3630  FOR K=FNA(X1) TO FNA(W)
3640  IF K=91 THEN 570
3650  READ #1,K;A$,D$,E$,F$
3660  PRINT #1,K
3670  IF S#1 THEN 3690
3680  GOSUB 3830
3690  PRINT #1;A$
3700  IF S#2 THEN 3720
3710  GOSUB 3830
3720  PRINT #1;D$
3730  IF S#3 THEN 3750
3740  GOSUB 3830
3750  PRINT #1;E$
3760  IF S#4 THEN 3780
3770  GOSUB 3830
3780  B$=F$
3790  S=1
3800  NEXT K
3810  X1=X1+1
3820  GOTO 3270
3830  PRINT #1;B$
3840  RETURN 
3850  READ #1,FNA(S);B$,D$,E$,F$
3860  GOTO FNB(S) OF 3890,3910,3930
3870  F$=A$
3880  GOTO 3940
3890  B$=A$
3900  GOTO 3940
3910  D$=A$
3920  GOTO 3940
3930  E$=A$
3940  PRINT #1,FNA(S);B$,D$,E$,F$
3950  RETURN 
3960  PRINT #2,1
3970  PRINT #2;U
3980  FOR T0=1 TO U
3990  PRINT #2;A[T0]
4000  NEXT T0
4010  RETURN 
4020  READ #2,1
4030  READ #2;U
4040  FOR T0=1 TO U
4050  READ #2;A[T0]
4060  NEXT T0
4070  B0=1
4080  RETURN 
4090  C=0
4100  FOR H=1+G TO 30
4110  IF B$[H,H]#"." THEN 4140
4120  X=H+1
4130  GOTO 4190
4140  FOR K=1 TO 10
4150  IF B$[H,H]=C$[K,K] THEN 4180
4160  NEXT K
4170  RETURN 
4180  C=10*C+K-1
4190  NEXT H
4200  RETURN 
4210  FOR G=K2 TO LEN(A$)-1
4220  IF A$[G,G]="," THEN 4260
4230  NEXT G
4240  K2=1
4250  RETURN 
4260  K2=G+1
4270  RETURN 
4280  PRINT "FIM DE TAREFA"
4290  END 
680 GOSUB 4273
4273 PRINT M7
4277 RETURN
