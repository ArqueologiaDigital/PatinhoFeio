10  REM     *********************************
20  REM     *                               *
30  REM     *    SIMULADOR   ' S I M 1 '    *
40 @REM     *                              *
50  REM     *********************************
60  REM	70  REM ** SIMULA UM COMPUTADOR OPERANDO EM DOS **
8  RAM ** ACEITA PROGRAMAS ESCRITOS EM ASSEMBLER **
90  REM ** AUTOR - SEBASTIAO SANTIAGO BARRETTO **
100  REM ** VERSAO 1 * LSD-EPUSP-DEE * 28/11/73 **
110  DEF FNA(X)=INT((X+3)/4)
120  DEF FNB(X)=X-INT((X-1)/4)*4
130  DIM A$[30],B$[30],C$[10],D$[54],E$[30],F$[30]
140  DIM A[256],X[9],Y[9]
150  FILES A,AA
160  B0=T=0
170  MAT A=ZER
180  C$="0123456789"
190  DATA "TA","FI","CH","GU","EX","CA","AP","MU","LI","PE","CO"
200  DATA "CAX","MDX","ARX"
210  DATA "CAR","ARM","SOM","SUB","MUL","DIV","IMP","IML"
220  DATA "LE ","MDM","DAI","PAR","NOP","MAD","MAE"
230  DATA "DZ ","DP ","DN ","DO ","D  ","DM ","BIB"
240  DATA "IS ","ABS","EXP","LOG","INT","SQR","RND","SIN","COS","ATN"
250  PRINT "@";
260  INPUT B$[1,30]
270  IF B$[1,1]#":" THEN 300
280  FOR I=1 TO 11
290  IF T+I#1 THEN 320
300  PRINT "IGNORADO"
310  GOTO 570
320  READ A$
330  IF B$[2,3]=A$ THEN 440
340  NEXT I
350  IF I#9 THEN 420
360  PRINT "NOME  TAMANHO"
370  FOR J=1 TO 9
380  IF D$[6*J-5,6*J]="      " THEN 400
390  PRINT D$[6*J-5,6*J];Y[J]
400  NEXT J
410  GOTO 570
420  PRINT "COMANDO INCORRETO ; REENTRE-O"
430  GOTO 570
440  K2=3
450  GOSUB 4620
460  IF I<6 THEN 560
470  READ #2,1;D$
480  MAT  READ #2;X,Y
490  IF K2=1 THEN 350
500  IF I=6 THEN 560
510  FOR J=1 TO 9
520  IF D$[6*J-5,6*J]=B$[K2,K2+5] THEN 560
530  NEXT J
540  PRINT "NAO EXISTE ESSE PROGRAMA"
550  GOTO 570
560  GOSUB I OF 590,4730,4290,4210,1730,620,4350,3380,3210,3170,970
570  RESTORE 
580  GOTO 250
590  T=1
600  PRINT "TAREFA"
610  RETURN 
620  FOR S=1 TO 9
630  IF D$[6*S-5,6*S]="      " THEN 670
640  NEXT S
650  PRINT "NAO HA MAIS ESPACO"
660  RETURN 
670  M=J=1
680  FOR L=1 TO 9
690  IF X[L]<M THEN 720
700  M=X[L]
710  J=L
720  NEXT L
730  X[S]=M+FNA(Y[J])
740  D$[6*S-5,6*S]=B$[K2,K2+5]
750  PRINT #2,1;D$
760  W=0
770  PRINT #1,X[S]
780  INPUT D$[1,31]
790  IF D$[1,1]#"'" THEN 810
800  D$[1,30]=D$[2,31]
810  IF W<360-4*X[S] THEN 840
820  PRINT "PROGRAMA MUITO LONGO"
830  RETURN 
840  PRINT #1;D$[1,30]
850  W=W+1
860  IF D$[5,7]#"FIM" THEN 780
870  IF FNB(W)=4 THEN 910
880  FOR I=FNB(W) TO 3
890  PRINT #1;D$[1,30]
900  NEXT I
910  PRINT 
920  Y[S]=M7=W
930  GOSUB 4680
940  PRINT "LINHAS"
950  MAT  PRINT #2;X,Y
960  RETURN 
970  B0=I2=1
980  FOR I=1 TO Y[J]-1
990  IF I2>256 THEN 820
1000  READ #1,X[J]+FNA(I)-1
1010  FOR K=1 TO FNB(I)
1020  READ #1;B$
1030  NEXT K
1040  W=L=0
1050  IF B$[1,1]="*" THEN 1670
1060  IF B$[5,7]="DFC" THEN 1300
1070  IF B$[5,7]#"BLC" THEN 1120
1080  GOSUB 4490
1090  I2=I2+C
1100  IF I2>256 THEN 820
1110  GOTO 1670
1120  FOR W=1 TO 25
1130  READ A$
1140  IF A$=B$[5,7] THEN 1200
1150  NEXT W
1160  C0=1
1170  PRINT "ERRO";C0;"NA INSTRUCAO";I
1180  B0=A[I2]=0
1190  GOTO 1650
1200  IF W#24 THEN 1230
1210  L=I+4*X[J]-4
1220  GOTO 1560
1230  IF W#25 THEN 1300
1240  FOR L=1 TO 10
1250  READ A$
1260  IF B$[12,14]=A$ THEN 1560
1270  NEXT L
1280  C0=3
1290  GOTO 1170
1300  G=12
1310  X=31
1320  V=-1
1330  IF B$[G,G]="-" THEN 1380
1340  V=1
1350  IF B$[G,G]="+" THEN 1380
1360  IF B$[G,G]>"9" THEN 1430
1370  G=11
1380  GOSUB 4500
1390  L=C*V
1400  IF X>H THEN 1560
1410  L=L/10^(H-X)
1420  GOTO 1560
1430  IF B$[12,14]="   " THEN 1560
1440  READ #1,X[J]
1450  FOR L1=1 TO Y[J]-1
1460  READ #1;A$
1470  IF A$[1,1]="*" THEN 1530
1480  L=L+1
1490  IF A$[1,3]=B$[12,14] THEN 1560
1500  IF A$[5,7]#"BLC" THEN 1530
1510  GOSUB 4490
1520  L=L+C-1
1530  NEXT L1
1540  C0=2
1550  GOTO 1170
1560  FOR B=1 TO 10
1570  IF B$[10,10]=C$[B,B] THEN 1620
1580  NEXT B
1590  B=1
1600  C0=4
1610  IF W>0 AND W<4 THEN 1170
1620  A[I2]=10000*W+1000*(B-1)+L
1630  IF B$[9,9]#"I" THEN 1650
1640  A[I2]=-A[I2]
1650  RESTORE 200
1660  I2=I2+1
1670  NEXT I
1680  U=I2-1
1690  IF B0=0 THEN 1710
1700  PRINT "NENHUM ERRO"
1710  PRINT "FIM DA COMPILACAO"
1720  RETURN 
1730  IF B0=1 THEN 1760
1740  PRINT "EXECUCAO IMPOSSIVEL"
1750  RETURN 
1760  A=O=X8=0
1770  MAT X=ZER
1780  I1=1
1790  PRINT 
1800  IF K2=1 THEN 1830
1810  IF B$[K2,K2]#"T" THEN 1830
1820  X8=1
1830  IF I1 <= U AND I1>0 THEN 1890
1840  E0=1
1850  PRINT "ERRO";E0;"EXECUCAO SUSPENSA"
1860  RETURN 
1870  PRINT "FIM DA EXECUCAO"
1880  RETURN 
1890  A2=ABS(A[I1])
1900  A5=INT(A2/10000)
1910  I5=INT(A2/1000-10*A5+.5)
1920  B=A2-A5*10000-I5*1000
1930  IF A5<4 OR I5=0 THEN 1950
1940  B=B+X[I5]
1950  IF A[I1]>0 THEN 1980
1960  IF B<1 OR B>U THEN 1840
1970  B=A[B]
1980  IF X8=0 THEN 2000
1990  PRINT "AC=";A;"IAR=";I1;"OV=";O
2000  IF I5=0 THEN 2020
2010  GOTO A5 OF 2570,2610
2020  IF A5>14 THEN 2060
2030  IF B<1 OR B>256 THEN 1840
2040  GOTO A5-2 OF 2590,2120,2140,2260,2300,2470
2050  GOTO A5-8 OF 2510,2340,2360,2380,2400,2440
2060  GOTO A5-14 OF 1870,2100,2680,2730,2160
2070  GOTO A5-19 OF 2180,2200,2220,2240,2780,2920
2080  E0=2
2090  GOTO 1850
2100  I1=I1+1
2110  GOTO 1830
2120  A=A[B]
2130  GOTO 2100
2140  A[B]=A
2150  GOTO 2100
2160  IF A=0 THEN 2240
2170  GOTO 2100
2180  IF A>0 THEN 2240
2190  GOTO 2100
2200  IF A<0 THEN 2240
2210  GOTO 2100
2220  IF O=0 THEN 2100
2230  O=0
2240  I1=B-1
2250  GOTO 2100
2260  A=A+A[B]
2270  IF ABS(A)<10^7 THEN 2100
2280  O=1
2290  GOTO 2100
2300  A=A-A[B]
2310  GOTO 2270
2320  O=1
2330  GOTO 2100
2340  PRINT A[B]
2350  GOTO 2100
2360  PRINT A[B];
2370  GOTO 2100
2380  INPUT A[B]
2390  GOTO 2100
2400  A[B]=A[B]-1
2410  IF A[B]#0 THEN 2100
2420  I1=I1+1
2430  GOTO 2100
2440  A[B]=I1+1
2450  I1=B
2460  GOTO 2100
2470  A=A*A[B]
2480  GOTO 2270
2490  O=1
2500  GOTO 2100
2510  IF A[B]#0 THEN 2550
2520  A=SGN(A)*10^38
2530  PRINT "DIVISAO POR ZERO"
2540  GOTO 2280
2550  A=A/A[B]
2560  GOTO 2270
2570  X[I5]=B
2580  GOTO 2100
2590  A[B]=X[I5]
2600  GOTO 2100
2610  L6=X[I5]+B
2620  IF X[I5]=0 OR SGN(X[I5])=SGN(L6) THEN 2640
2630  I1=I1+1
2640  X[I5]=L6
2650  GOTO 2100
2660  A=-A
2670  GOTO 2100
2680  IF B <= 0 THEN 2100
2690  FOR F2=1 TO B
2700  A=INT(A/10)
2710  NEXT F2
2720  GOTO 2100
2730  IF B <= 0 THEN 2100
2740  FOR F2=1 TO B
2750  A=10*(A-INT(A/100000.)*100000.)
2760  NEXT F2
2770  GOTO 2100
2780  READ #1,FNA(B);A$,B$,E$,F$
2790  GOTO FNB(B) OF 2830,2820,2810,2800
2800  E$=F$
2810  B$=E$
2820  A$=B$
2830  FOR K7=12 TO 30
2840  IF A$[K7,K7]#"'" THEN 2890
2850  IF K7=30 THEN 2100
2860  IF A$[K7+1,K7+1]#"'" THEN 2100
2870  PRINT 
2880  GOTO 2100
2890  PRINT A$[K7,K7];
2900  NEXT K7
2910  GOTO 2100
2920  GOTO B OF 2950,2970,2990,3010,3050,3070,3110,3130,3150
2930  A=ATN(A)
2940  GOTO 2100
2950  A=-A
2960  GOTO 2100
2970  A=ABS(A)
2980  GOTO 2100
2990  A=EXP(A)
3000  GOTO 2100
3010  E0=3
3020  IF A <= 0 THEN 1850
3030  A=LOG(A)
3040  GOTO 2100
3050  A=INT(A)
3060  GOTO 2100
3070  E0=4
3080  IF A<0 THEN 1850
3090  A=SQR(A)
3100  GOTO 2100
3110  A=RND(0)
3120  GOTO 2100
3130  A=SIN(A)
3140  GOTO 2100
3150  A=COS(A)
3160  GOTO 2100
3170  PRINT ""
3180  FOR R3=1 TO 1000
3190  NEXT R3
3200  GOTO 3230
3210  PRINT ""
3220  R3=1
3230  READ #1,X[J]
3240  FOR M7=1 TO Y[J]
3250  READ #1;A$
3260  IF R3=1 THEN 3300
3270  IF A$[1,1]#" " THEN 3310
3280  PRINT "'";
3290  GOTO 3310
3300  GOSUB 4680
3310  FOR F=30 TO 1 STEP -1
3320  IF A$[F,F]#" " THEN 3340
3330  NEXT F
3340  PRINT A$[1,F]
3350  NEXT M7
3360  PRINT ""
3370  RETURN 
3380  PRINT #2,1;D$
3390  GOTO 3420
3400  IF B=3 THEN 3840
3410  PRINT "IGNORADO"
3420  B=0
3430  INPUT B$[1,30]
3440  IF B$[1,1]#"/" THEN 3400
3450  IF B$[2,2]#"F" THEN 3480
3460  MAT  PRINT #2;X,Y
3470  RETURN 
3480  K2=B=3
3490  GOSUB 4620
3500  GOSUB 4500
3510  IF C<1 OR C>Y[J] THEN 3410
3520  S=X[J]*4+C-4
3530  IF B$[2,2]="I" THEN 3830
3540  IF B$[2,2]="S" THEN 4090
3550  IF B$[2,2]#"A" THEN 3410
3560  G1=FNB(S)
3570  FOR K=FNA(S) TO FNA(W)
3580  READ #1,K;A$,B$,D$,E$
3590  IF K=90 THEN 820
3600  READ #1;F$
3610  GOTO G1 OF 3650,3640,3630
3620  E$=D$
3630  D$=B$
3640  B$=A$
3650  PRINT #1,K;B$,D$,E$,F$
3660  G1=1
3670  NEXT K
3680  L=-1
3690  GOSUB 3710
3700  GOTO 3420
3710  IF FNA(Y[J])=FNA(Y[J]+L) THEN 3810
3720  U=FNA(Y[J])+X[J]+1
3730  FOR K=ABS(-L*89 MIN U) TO ABS(L*90 MIN U) STEP -L
3740  READ #1,K;A$,B$,E$,F$
3750  PRINT #1,K+L;A$,B$,E$,F$
3760  NEXT K
3770  FOR K=1 TO 9
3780  IF X[K] <= X[J] THEN 3800
3790  X[K]=X[K]+L
3800  NEXT K
3810  Y[J]=Y[J]+L
3820  RETURN 
3830  INPUT B$[1,30]
3840  A=FNB(S)
3850  L=1
3860  GOSUB 3710
3870  FOR K=FNA(S) TO FNA(Y[J])
3880  IF K=91 THEN 820
3890  READ #1,K;A$,D$,E$,F$
3900  PRINT #1,K
3910  IF A#1 THEN 3930
3920  GOSUB 4070
3930  PRINT #1;A$
3940  IF A#2 THEN 3960
3950  GOSUB 4070
3960  PRINT #1;D$
3970  IF A#3 THEN 3990
3980  GOSUB 4070
3990  PRINT #1;E$
4000  IF A#4 THEN 4020
4010  GOSUB 4070
4020  B$=F$
4030  A=1
4040  NEXT K
4050  S=S+1
4060  GOTO 3430
4070  PRINT #1;B$
4080  RETURN 
4090  INPUT A$[1,30]
4100  READ #1,FNA(S);B$,D$,E$,F$
4110  GOTO FNB(S) OF 4140,4160,4180
4120  F$=A$
4130  GOTO 4190
4140  B$=A$
4150  GOTO 4190
4160  D$=A$
4170  GOTO 4190
4180  E$=A$
4190  PRINT #1,FNA(S);B$,D$,E$,F$
4200  GOTO 3430
420  IF B0#0 THEN 4240
4220  PRINT "NENHUM PROGRAMA COMPILADO"
4230  RETURN 
4240  PRINT #2,2;U
4250  FOR T0=1 TO U
4260  PRINT #2;A[T0]
4270  NEXT T0
4280  RETURN 
4290  READ #2,2;U
4300  FOR T0=1 TO U
4310  READ #2;A[T0]
4320  NEXT T0
4330  B0=1
4340  RETURN 
4350  F=FNA(Y[J])
4360  FOR L=1 TO 9
4370  IF X[L] <= X[J] THEN 4390
4380  X[L]=X[L]-F
4390  NEXT L
4400  FOR L=X[J]+F TO 89
4410  READ #1,L;A$,B$,E$,F$
4420  PRINT #1,L-F;A$,B$,E$,F$
4430  NEXT L
4440  D$[6*J-5,6*J]=" "
4450  PRINT #2,1;D$
4460  X[J]=Y[J]=0
4470  MAT  PRINT #2;X,Y
4480  RETURN 
4490  G=11
4500  C=0
4510  FOR H=1+G TO 30
4520  IF B$[H,H]#"." THEN 4550
4530  X=H+1
4540  GOTO 4600
4550  FOR K=1 TO 10
4560  IF B$[H,H]=C$[K,K] THEN 4590
4570  NEXT K
4580  RETURN 
4590  C=10*C+K-1
4600  NEXT H
4610  RETURN 
4620  FOR G=K2 TO 24
4630  IF B$[G,G]="," THEN 4660
4640  NEXT G
4650  G=0
4660  K2=G+1
4670  RETURN 
4680  A=INT(M7/100)+1
4690  B=INT(M7/10-10*A+11)
4700  C=M7-100*A-10*B+111
4710  PRINT C$[A,A];C$[B,B];C$[C,C];"  ";
4720  RETURN 
4730  PRINT "FIM DE TAREFA"
4740  END 
