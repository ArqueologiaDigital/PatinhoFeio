10  REM     *********************************
20  REM     *                               *
30  REM     *    SIMULADOR   ' S I M U '    *
40  REM     *                               *
50  REM     *********************************
60  REM
70  REM ** SIMULA UM COMPUTADOR OPERANDO EM DOS **
80  REM ** ACEITA PROGRAMAS ESCRITOS EM ASSEMBLER **
90  REM ** AUTOR - SEBASTIAO SANTIAGO BARRETTO **
100  REM ** VERSAO 1 * LSD-EPUSP-DEE * 28/9/73 **
110  DEF FNA(X)=INT((X+3)/4)
120  DEF FNB(X)=X-INT((X-1)/4)*4
130  DIM A$[30],B$[30],C$[10],D$[54],E$[30],F$[30]
140  DIM A[256],X[9],Y[9]
150  FILES A,B
160  B0=T=0
170  MAT A=ZER
180  C$="0123456789"
190  DATA "TA","FI","CH","GU","EX","CA","AP","MU","LI","PE","CO"
200  DATA "CAX","MDX","ARX"
210  DATA "CAR","ARM","SOM","SUB","MUL","DIV","IMP","IML"
220  DATA "LE ","MDM","DAI","PAR","NOP","MAD","MAE"
230  DATA "DZ ","DP ","DN ","DO ","D  ","DM ","BIB"
240  DATA "IS ","ABS","EXP","LOG","INT","SQR","RND","SIN","COS","ATN"
250  PRINT "@";
260  INPUT B$[1,30]
270  IF B$[1,1]#":" THEN 300
280  FOR I=1 TO 11
290  IF T#0 OR I<3 THEN 320
300  PRINT "IGNORADO"
310  GOTO 570
320  READ A$
330  IF B$[2,3]=A$ THEN 440
340  NEXT I
350  IF I#9 THEN 420
360  PRINT "NOME  TAMANHO"
370  FOR J=1 TO 9
380  IF D$[6*J-5,6*J]="      " THEN 400
390  PRINT D$[6*J-5,6*J];Y[J]
400  NEXT J
410  GOTO 570
420  PRINT "COMANDO INCORRETO ; REENTRE-O"
430  GOTO 570
440  K2=3
450  GOSUB 4650
460  IF I<6 THEN 560
470  READ #2,1;D$
480  MAT  READ #2;X,Y
490  IF K2=1 THEN 350
500  IF I=6 THEN 560
510  FOR J=1 TO 9
520  IF D$[6*J-5,6*J]=B$[K2,K2+5] THEN 560
530  NEXT J
540  PRINT "NAO EXISTE ESSE PROGRAMA"
550  GOTO 570
560  GOSUB I OF 590,4760,4340,4290,1770,620,4390,3510,3320,3280,980
570  RESTORE 
580  GOTO 250
590  T=1
600  PRINT "TAREFA"
610  RETURN 
620  FOR S=1 TO 9
630  IF D$[6*S-5,6*S]="      " THEN 670
640  NEXT S
650  PRINT "NAO HA MAIS ESPACO"
660  RETURN 
670  M=J=1
680  FOR L=1 TO 9
690  IF X[L]<M THEN 720
700  M=X[L]
710  J=L
720  NEXT L
730  X[S]=M+FNA(Y[J])
740  D$[6*S-5,6*S]=B$[K2,K2+5]
750  PRINT #2,1;D$
760  W=0
770  PRINT #1,X[S]
780  INPUT D$[1,31]
790  IF D$[1,1]#"'" THEN 810
800  D$[1,30]=D$[2,31]
810  IF W<360-4*X[S] THEN 840
820  PRINT "PROGRAMA MUITO LONGO"
830  RETURN 
840  PRINT #1;D$[1,30]
850  W=W+1
860  IF D$[5,7]#"FIM" THEN 780
870  IF FNB(W)=4 THEN 910
880  FOR I=FNB(W) TO 3
890  PRINT #1;D$[1,30]
900  NEXT I
910  PRINT 
920  M7=W
930  GOSUB 4710
940  PRINT "LINHAS"
950  Y[S]=W
960  MAT  PRINT #2;X,Y
970  RETURN 
980  B0=I2=1
990  FOR I=1 TO Y[J]-1
1000  IF I2>256 THEN 820
1010  READ #1,X[J]+FNA(I)-1
1020  FOR K=1 TO FNB(I)
1030  READ #1;B$
1040  NEXT K
1050  W=L=0
1060  IF B$[1,1]="*" THEN 1710
1070  IF B$[5,7]="DC " THEN 1410
1080  IF B$[5,7]#"BLC" THEN 1160
1090  G=11
1100  GOSUB 4530
1110  FOR I2=I2 TO I2+C-1
1120  IF I2>256 THEN 820
1130  A[I2]=0
1140  NEXT I2
1150  GOTO 1700
1160  FOR W=1 TO 25
1170  READ A$
1180  IF A$=B$[5,7] THEN 1240
1190  NEXT W
1200  C0=1
1210  PRINT "ERRO";C0;"NA INSTRUCAO";I
1220  B0=W=0
1230  GOTO 1660
1240  IF W#24 THEN 1270
1250  L=I+4*X[J]-4
1260  GOTO 1660
1270  IF W#25 THEN 1350
1280  FOR L=1 TO 10
1290  READ A$
1300  IF B$[12,14]=A$ THEN 1660
1310  NEXT L
1320  L=0
1330  C0=3
1340  GOTO 1210
1350  FOR B=2 TO 10
1360  IF B$[10,10]=C$[B,B] THEN 1410
1370  NEXT B
1380  B=1
1390  C0=4
1400  IF W<4 THEN 1210
1410  G=12
1420  X=31
1430  V=-1
1440  IF B$[G,G]="-" THEN 1470
1450  V=1
1460  IF B$[G,G]#"+" THEN 1520
1470  GOSUB 4530
1480  L=C*V
1490  IF X>H THEN 1660
1500  L=L/10^(H-X)
1510  GOTO 1660
1520  IF B$[12,14]="   " THEN 1660
1530  READ #1,X[J]
1540  FOR L1=1 TO X[J]-1
1550  READ #1;A$
1560  IF A$[1,1]="*" THEN 1630
1570  L=L+1
1580  IF A$[1,3]=B$[12,14] THEN 1660
1590  IF A$[5,7]#"BLC" THEN 1630
1600  G=1
1610  GOSUB 4530
1620  L=L+C-1
1630  NEXT L1
1640  C0=2
1650  GOTO 1210
1660  A[I2]=10000*W+1000*(B-1)+L
1670  IF B$[9,9]#"I" THEN 1690
1680  A[I2]=-A[I2]
1690  RESTORE 200
1700  I2=I2+1
1710  NEXT I
1720  U=I2-1
1730  IF B0=0 THEN 1750
1740  PRINT "NENHUM ERRO"
1750  PRINT "FIM DA COMPILACAO"
1760  RETURN 
1770  IF B0=1 THEN 1820
1780  PRINT "EXECUCAO IMPOSSIVEL"
1790  RETURN 
1800  E0=2
1810  GOTO 1940
1820  A=O=X8=0
1830  MAT X=ZER
1840  I1=1
1850  C=120
1860  IF K2=1 THEN 1920
1870  IF A$[K2,K2]#"T" THEN 1910
1880  X8=1
1890  GOSUB 4650
1900  IF K2=1 THEN 1920
1910  GOSUB 4530
1920  IF I1 <= U AND I1>0 THEN 1980
1930  E0=1
1940  PRINT "ERRO";E0;"EXECUCAO SUSPENSA"
1950  RETURN 
1960  PRINT "FIM DA EXECUCAO"
1970  RETURN 
1980  A2=ABS(A[I1])
1990  A5=INT(A2/10000)
2000  I5=INT(A2/1000-10*A5)
2010  B=A2-A5*10000-I5*1000
2020  IF A5<4 OR I5=0 THEN 2040
2030  B=B+X[I5]
2040  IF B>0 THEN 2070
2050  IF B<1 OR B>U THEN 1930
2060  B=A[B]
2070  IF X8=0 THEN 2090
2080  PRINT "AC=";A;"IAR=";I1;"OV=";O
2090  GOTO A5 OF 2670,2710
2100  IF B<1 OR B>U THEN 2130
2110  GOTO A5-2 OF 2690,2220,2240,2360,2400,2570
2120  GOTO A5-8 OF 2610,2440,2460,2480,2500,2540
2130  GOTO A5-14 OF 1960,2170,2780,2830,2260
2140  GOTO A5-19 OF 2280,2300,2320,2340,2880,3030
2150  IF A5>25 OR A5<1 THEN 1800
2160  GOTO 1930
2170  I1=I1+1
2180  C=C-.01
2190  IF C>0 THEN 1920
2200  PRINT "ULTRAPASSOU O LIMITE DE TEMPO"
2210  RETURN 
2220  A=A[B]
2230  GOTO 2170
2240  A[B]=A
2250  GOTO 2170
2260  IF A=0 THEN 2340
2270  GOTO 2170
2280  IF A>0 THEN 2340
2290  GOTO 2170
2300  IF A<0 THEN 2340
2310  GOTO 2170
2320  IF O=0 THEN 2170
2330  O=0
2340  I1=B-1
2350  GOTO 2170
2360  A=A+A[B]
2370  IF ABS(A)<10^7 THEN 2340
2380  O=1
2390  GOTO 2170
2400  A=A-A[B]
2410  GOTO 2370
2420  O=1
2430  GOTO 2170
2440  PRINT A[B]
2450  GOTO 2170
2460  PRINT A[B];
2470  GOTO 2170
2480  INPUT A[B]
2490  GOTO 2170
2500  A[B]=A[B]-1
2510  IF A[B]#0 THEN 2170
2520  I1=I1+1
2530  GOTO 2170
2540  A[B]=I1+1
2550  I1=B
2560  GOTO 2170
2570  A=A*A[B]
2580  GOTO 2370
2590  O=1
2600  GOTO 2170
2610  IF A[B]#0 THEN 2650
2620  A=SGN(A)*10^38
2630  PRINT "DIVISAO POR ZERO"
2640  GOTO 2380
2650  A=A/A[B]
2660  GOTO 2370
2670  X[I5]=B
2680  GOTO 2170
2690  A[B]=X[I5]
2700  GOTO 2170
2710  L6=X[I5]+B
2720  IF X[I5]=0 OR SGN(X[I5])=SGN(L6) THEN 2740
2730  I1=I1+1
2740  X[I5]=L6
2750  GOTO 2170
2760  A=-A
2770  GOTO 2170
2780  IF B <= 0 THEN 2170
2790  FOR F2=1 TO B
2800  A=INT(A/10)
2810  NEXT F2
2820  GOTO 2170
2830  IF B <= 0 THEN 2170
2840  FOR F2=1 TO B
2850  A=10*(A-INT(A/100000.)*100000.)
2860  NEXT F2
2870  GOTO 2170
2880  READ #1,FNA(B);A$,B$,E$,F$
2890  GOTO FNB(B) OF 2930,2920,2910,2900
2900  E$=F$
2910  B$=E$
2920  A$=B$
2930  FOR K7=12 TO 30
2940  C=C-.1
2950  IF A$[K7,K7]#"'" THEN 3000
2960  IF K7=30 THEN 2170
2970  IF A$[K7+1,K7+1]#"'" THEN 2170
2980  PRINT 
2990  GOTO 2170
3000  PRINT A$[K7,K7];
3010  NEXT K7
3020  GOTO 2170
3030  GOTO B OF 3060,3080,3100,3120,3160,3180,3220,3240,3260
3040  A=ATN(A)
3050  GOTO 2170
3060  A=-A
3070  GOTO 2170
3080  A=ABS(A)
3090  GOTO 2170
3100  A=EXP(A)
3110  GOTO 2170
3120  E0=3
3130  IF A <= 0 THEN 1940
3140  A=LOG(A)
3150  GOTO 2170
3160  A=INT(A)
3170  GOTO 2170
3180  E0=4
3190  IF A<0 THEN 1940
3200  A=SQR(A)
3210  GOTO 2170
3220  A=RND(0)
3230  GOTO 2170
3240  A=SIN(A)
3250  GOTO 2170
3260  A=COS(A)
3270  GOTO 2170
3280  PRINT ""
3290  FOR R3=1 TO 1000
3300  NEXT R3
3310  GOTO 3340
3320  PRINT ""
3330  R3=1
3340  READ #1,X[J]
3350  FOR M7=1 TO Y[J]
3360  READ #1;A$
3370  IF R3=1 THEN 3410
3380  IF A$[1,1]#" " THEN 3420
3390  PRINT "'";
3400  GOTO 3420
3410  GOSUB 4710
3420  FOR F=30 TO 1 STEP -1
3430  IF A$[F,F]#" " THEN 3450
3440  NEXT F
3450  PRINT A$[1,F]
3460  NEXT M7
3470  PRINT ""
3480  RETURN 
3490  IF H=3 THEN 3940
3500  PRINT "IGNORADO"
3510  H=0
3520  PRINT #2,1;D$
3530  INPUT B$[1,30]
3540  IF B$[1,1]#"/" THEN 3490
3550  IF B$[2,2]#"F" THEN 3580
3560  MAT  PRINT #2;X,Y
3570  RETURN 
3580  K2=H=3
3590  GOSUB 4650
3600  IF K2=1 THEN 3500
3610  GOSUB 4530
3620  S=X[J]*4+C-4
3630  IF B$[2,2]="I" THEN 3930
3640  IF B$[2,2]="S" THEN 4170
3650  IF B$[2,2]#"A" THEN 3500
3660  G1=FNB(S)
3670  FOR K=FNA(S) TO FNA(W)
3680  READ #1,K;A$,B$,D$,E$
3690  IF K=90 THEN 820
3700  READ #1;F$
3710  GOTO G1 OF 3750,3740,3730
3720  E$=D$
3730  D$=B$
3740  B$=A$
3750  PRINT #1,K;B$,D$,E$,F$
3760  G1=1
3770  NEXT K
3780  L=-1
3790  GOSUB 3810
3800  GOTO 3510
3810  IF FNA(Y[J])#FNA(Y[J]+L) THEN 3910
3820  U=FNA(Y[J])+X[J]+1
3830  FOR K=ABS(-L*89 MIN U) TO ABS(L*90 MIN U) STEP -L
3840  READ #1,K;A$,B$,E$,F$
3850  PRINT #1,K+L;A$,B$,E$,F$
3860  NEXT K
3870  FOR K=1 TO 9
3880  IF X[K] <= X[J] THEN 3900
3890  X[K]=X[K]+L
3900  NEXT K
3910  Y[J]=Y[J]+L
3920  RETURN 
3930  INPUT B$[1,30]
3940  A=FNB(S)
3950  L=1
3960  GOSUB 3810
3970  FOR K=FNA(S) TO FNA(S+Y[J])
3980  IF K=91 THEN 820
3990  READ #1,K;A$,D$,E$,F$
4000  PRINT #1,K
4010  IF A#1 THEN 4030
4020  PRINT #1;B$
4030  PRINT #1;A$
4040  IF A#2 THEN 4060
4050  PRINT #1;B$
4060  PRINT #1;D$
4070  IF A#3 THEN 4090
4080  PRINT #1;B$
4090  PRINT #1;E$
4100  IF A#4 THEN 4120
4110  PRINT #1;B$
4120  B$=F$
4130  A=1
4140  NEXT K
4150  S=S+1
4160  GOTO 3530
4170  INPUT A$[1,30]
4180  READ #1,FNA(S);B$,D$,E$,F$
4190  GOTO FNB(S) OF 4220,4240,4260
4200  F$=A$
4210  GOTO 4270
4220  B$=A$
4230  GOTO 4270
4240  D$=A$
4250  GOTO 4270
4260  E$=A$
4270  PRINT #1,FNA(S);B$,D$,E$,F$
4280  GOTO 3530
4290  PRINT #2,2;U
4300  FOR T0=1 TO U
4310  PRINT #2;A[T0]
4320  NEXT T0
4330  RETURN 
4340  READ #2,2;U
4350  FOR T0=1 TO U
4360  READ #2;A[T0]
4370  NEXT T0
4380  RETURN 
4390  F=FNA(Y[J])
4400  A=X[J]
4410  FOR L=1 TO 9
4420  IF X[L]<A THEN 4440
4430  X[L]=X[L]-F
4440  NEXT L
4450  FOR L=X[J]+F TO 89
4460  READ #1,L;A$,B$,E$,F$
4470  PRINT #1,L-F;A$,B$,E$,F$
4480  NEXT L
4490  D$[6*J-5,6*J]=" "
4500  PRINT #2,1;D$
4510  MAT  PRINT #2;X,Y
4520  RETURN 
4530  C=0
4540  FOR H=1+G TO 30
4550  IF B$[H,H]#"." THEN 4580
4560  X=H+1
4570  GOTO 4630
4580  FOR K=1 TO 10
4590  IF B$[H,H]=C$[K,K] THEN 4620
4600  NEXT K
4610  RETURN 
4620  C=10*C+K-1
4630  NEXT H
4640  RETURN 
4650  FOR G=K2 TO 24
4660  IF B$[G,G]="," THEN 4690
4670  NEXT G
4680  G=0
4690  K2=G+1
4700  RETURN 
4710  A=INT(M7/100)+1
4720  B=INT(M7/10-10*A+11)
4730  C=M7-100*A-10*B+111
4740  PRINT C$[A,A];C$[B,B];C$[C,C];"  ";
4750  RETURN 
4760  PRINT "FIM DE TAREFA"
4770  END 
