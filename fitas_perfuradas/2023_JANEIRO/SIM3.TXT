10  REM     *********************************
20  REM     *                               *
30  REM     *    SIMULADOR   ' S I M U '    *
40  REM     *                               *
50  REM     *********************************
60  REM
70  REM ** SIMULA UM COMPUTADOR OPERANDO EM DOS **
80  REM ** ACEITA PROGRAMAS ESCRITOS EM ASSEMBLER **
90  REM ** AUTOR - SEBASTIAO SANTIAGO BARRETTO **
100  REM ** VERSAO 1 * LSD-EPUSP-DEE * 28/9/73 **
110  DEF FNA(X)=INT((X+3)/4)
120  DEF FNB(X)=X-INT((X-1)/4)*4
130  DIM A$[30],B$[30],C$[10],D$[54],E$[30],F$[30]
140  DIM A[300],X[9],Y[9]
150  FILES A,B
160  B0=T=0
170  A1=1
180  MAT A=ZER
190  C$="0123456789"
200  DATA "TA","FI","CH","GU","EX","CA","AP","MU","LI","PE","CO"
210  DATA "CAX","MDX","SOX","SUX","MUX","DIX","ARX"
220  DATA "CAR","ARM","SOM","SUB","MUL","DIV","IMP","IML"
230  DATA "LE ","MDM","DAI","PAR","DC ","NOP","MAD","MAE"
240  DATA "DZ ","DP ","DN ","DO ","D  ","DM ","BIB"
250  DATA "IS ","ABS","EXP","LOG","INT","SQR","RND","SIN","COS","ATN"
260  PRINT "@";
270  INPUT B$[1,30]
280  IF B$[1,1]#":" THEN 310
290  FOR I=1 TO 10
300  IF T#0 OR I<3 THEN 330
310  PRINT "IGNORADO"
320  GOTO 490
330  READ A$
340  IF B$[2,3]=A$ THEN 380
350  NEXT I
360  PRINT "COMANDO INCORRETO ; REENTRE-O"
370  GOTO 490
380  K2=3
390  GOSUB 4700
400  IF I<7 THEN 480
410  READ #2,1;D$
420  MAT  READ #2;X,Y
430  FOR J=1 TO 9
440  IF D$[6*J-5,6*J]=B$[K2,K2+5] THEN 480
450  NEXT J
460  PRINT "NAO EXISTE ESSE PROGRAMA"
470  GOTO 490
480  GOSUB I OF 510,4820,4380,4320,1660,540,4440,3470,3290,3240,890
490  RESTORE 
500  GOTO 260
510  T=1
520  PRINT "TAREFA"
530  RETURN 
540  FOR S=1 TO 9
550  IF D$[6*S-5,6*S]=" " THEN 590
560  NEXT S
570  PRINT "NAO HA MAIS ESPACO"
580  RETURN 
590  M=1
600  FOR L=1 TO 9
610  IF X[L]<M THEN 640
620  M=X[L]
630  J=L
640  NEXT L
650  X[S]=M+FNA(Y[J])
660  D$[5*S-5,6*S]=B$[K2,K2+5]
670  W=0
680  INPUT D$[1,31]
690  IF D$[1,1]#"'" THEN 710
700  D$[1,30]=D$[2,31]
710  IF W<360-4*X[S] THEN 740
720  PRINT "PROGRAMA MUITO LONGO"
730  RETURN 
740  PRINT #1;D$[1,30]
750  W=W+1
760  IF D$[5,7]#"FIM" THEN 680
770  IF FNB(W)=4 THEN 880
780  FOR I=FNB(W) TO 3
790  PRINT #1;D$[1,30]
800  NEXT I
810  PRINT 
820  M7=W
830  GOSUB 4770
840  PRINT "LINHAS"
850  Y[S]=W
860  PRINT #2,1;D$
870  MAT  PRINT #2;X,Y
880  RETURN 
890  B0=I2=1
900  FOR I=1 TO X[J]-1
910  READ #1,FNA(Y[J])+I
920  FOR K=1 TO FNB(I)
930  READ #1;B$
940  NEXT K
950  W=L=0
960  IF B$[1,1]="*" THEN 1600
970  IF B$[5,7]="DC " THEN 1300
980  IF B$[5,7]#"BLC" THEN 1050
990  G=11
1000  GOSUB 4580
1010  FOR I2=I2 TO I2+C
1020  A[I2]=0
1030  NEXT I2
1040  GOTO 1600
1050  FOR W=1 TO 30
1060  READ A$
1070  IF A$=B$[5,7] THEN 1130
1080  NEXT W
1090  C0=1
1100  PRINT "ERRO";C0;"NA INSTRUCAO";I
1110  B0=J=0
1120  GOTO 1550
1130  IF W#29 THEN 1160
1140  W=I+4*X[J]-4
1150  GOTO 1550
1160  IF W#30 THEN 1240
1170  FOR L=1 TO 10
1180  READ A$
1190  IF B$[12,14]=A$ THEN 1550
1200  NEXT L
1210  L=0
1220  C0=3
1230  GOTO 1100
1240  FOR B=2 TO 10
1250  IF B$[10,10]=C$[B,B] THEN 1300
1260  NEXT B
1270  B=1
1280  C0=4
1290  IF W<8 THEN 1100
1300  G=12
1310  X=31
1320  V=-1
1330  IF B$[G,G]="-" THEN 1360
1340  V=1
1350  IF B$[G,G]#"+" THEN 1410
1360  GOSUB 4580
1370  L=C*V
1380  IF X>H THEN 1550
1390  L=L/10^(H-X)
1400  GOTO 1550
1410  IF B$[12,14]="   " THEN 1550
1420  READ #1,X[J]
1430  FOR L1=1 TO X[J]-1
1440  READ #1;A$
1450  IF A$[1,1]="*" THEN 1520
1460  L=L+1
1470  IF A$[1,3]=B$[12,14] THEN 1550
1480  IF A$[5,7]#"BLC" THEN 1520
1490  G=1
1500  GOSUB 4580
1510  L=L+C-1
1520  NEXT L1
1530  C0=2
1540  GOTO 1100
1550  A[I2]=10000*W+1000*(B-1)+L
1560  IF B$[9,9]#"I" THEN 1580
1570  A[I2]=-A[I2]
1580  RESTORE 210
1590  I2=I2+1
1600  NEXT I
1610  U=I2
1620  IF B0=0 THEN 1640
1630  PRINT "NENHUM ERRO"
1640  PRINT "FIM DA COMPILACAO"
1650  RETURN 
1660  IF B0=1 THEN 1710
1670  PRINT "EXECUCAO IMPOSSIVEL"
1680  RETURN 
1690  E0=2
1700  GOTO 1830
1710  A=O=X8=0
1720  MAT X=ZER
1730  I1=1
1740  C=120
1750  IF K2=1 THEN 1810
1760  IF A$[K2,K2]#"T" THEN 1800
1770  X8=1
1780  GOSUB 4700
1790  IF K2=1 THEN 1810
1800  GOSUB 4580
1810  IF I1 <= U AND I1>0 THEN 1870
1820  E0=1
1830  PRINT "ERRO";E0;"EXECUCAO SUSPENSA"
1840  RETURN 
1850  PRINT "FIM DA EXECUCAO"
1860  RETURN 
1870  A2=ABS(A[I1])
1880  A5=INT(A2/10000)
1890  I5=INT(A2/1000-10*A5)
1900  B=A2-A5*10000-I5*1000
1910  IF I5=0 THEN 1950
1920  GOTO A5 OF 2630,2670
1930  IF A5<7 THEN 2120
1940  B=B+X[I5]
1950  IF B<1 OR B>U THEN 1820
1960  IF B>0 THEN 1980
1970  B=A[B]
1980  IF X8=0 THEN 2000
1990  PRINT "AC=";A;"IAR=";I1;"OV=";O
2000  IF B<1 OR B>U THEN 2030
2010  GOTO A5-6 OF 2650,2150,2170,2320,2360,2530
2020  GOTO A5-12 OF 2570,2400,2420,2440,2460,2500
2030  GOTO A5-18 OF 1850,1690,2070,2740,2790,2190
2040  GOTO A5-24 OF 2220,2250,2280,2260,2840,2990
2050  IF A5>30 OR A5<1 THEN 1690
2060  GOTO 1820
2070  I1=I1+1
2080  C=C-.01
2090  IF C>0 THEN 1810
2100  PRINT "ULTRAPASSOU O LIMITE DE TEMPO"
2110  RETURN 
2120  B=401
2130  A[401]=X[I5]
2140  GOTO A5-2 OF 2320,2360,2530,2570
2150  A=A[B]
2160  GOTO 2070
2170  A[B]=A
2180  GOTO 2070
2190  IF A#0 THEN 2070
2200  I1=B-1
2210  GOTO 2070
2220  IF A <= 0 THEN 2070
2230  I1=B-1
2240  GOTO 2070
2250  IF A >= 0 THEN 2070
2260  I1=B-1
2270  GOTO 2070
2280  IF O=0 THEN 2070
2290  I1=B-1
2300  O=0
2310  GOTO 2070
2320  A=A+A[B]
2330  IF ABS(A)<10^7 THEN 2300
2340  O=1
2350  GOTO 2070
2360  A=A-A[B]
2370  GOTO 2330
2380  O=1
2390  GOTO 2070
2400  PRINT A[B]
2410  GOTO 2070
2420  PRINT A[B];
2430  GOTO 2070
2440  INPUT A[B]
2450  GOTO 2070
2460  A[B]=A[B]-1
2470  IF A[B]#0 THEN 2070
2480  I1=I1+1
2490  GOTO 2070
2500  A[B]=I1+1
2510  I1=B
2520  GOTO 2070
2530  A=A*A[B]
2540  GOTO 2330
2550  O=1
2560  GOTO 2070
2570  IF A[B]#0 THEN 2610
2580  A=SGN(A)*10^38
2590  PRINT "DIVISAO POR ZERO"
2600  GOTO 2340
2610  A=A/A[B]
2620  GOTO 2330
2630  X[I5]=B
2640  GOTO 2070
2650  A[B]=X[I5]
2660  GOTO 2070
2670  L6=X[I5]+B
2680  IF X[I5]=0 OR SGN(X[I5])=SGN(L6) THEN 2700
2690  I1=I1+1
2700  X[I5]=L6
2710  GOTO 2070
2720  A=-A
2730  GOTO 2070
2740  IF B <= 0 THEN 2070
2750  FOR F2=1 TO B
2760  A=INT(A/10)
2770  NEXT F2
2780  GOTO 2070
2790  IF B <= 0 THEN 2070
2800  FOR F2=1 TO B
2810  A=10*(A-INT(A/100000.)*100000.)
2820  NEXT F2
2830  GOTO 2070
2840  READ #1,FNA(B);A$,B$,E$,F$
2850  GOTO FNB(B) OF 2890,2880,2870,2860
2860  E$=F$
2870  B$=E$
2880  A$=B$
2890  FOR K7=12 TO 30
2900  C=C-.1
2910  IF A$[K7,K7]#"'" THEN 2960
2920  IF K7=30 THEN 2070
2930  IF A$[K7+1,K7+1]#"'" THEN 2070
2940  PRINT 
2950  GOTO 2070
2960  PRINT A$[K7,K7];
2970  NEXT K7
2980  GOTO 2070
2990  GOTO B OF 3020,3040,3060,3080,3120,3140,3180,3200,3220
3000  A=ATN(A)
3010  GOTO 2070
3020  A=-A
3030  GOTO 2070
3040  A=ABS(A)
3050  GOTO 2070
3060  A=EXP(A)
3070  GOTO 2070
3080  E0=3
3090  IF A <= 0 THEN 1830
3100  A=LOG(A)
3110  GOTO 2070
3120  A=INT(A)
3130  GOTO 2070
3140  E0=4
3150  IF A<0 THEN 1830
3160  A=SQR(A)
3170  GOTO 2070
3180  A=RND(0)
3190  GOTO 2070
3200  A=SIN(A)
3210  GOTO 2070
3220  A=COS(A)
3230  GOTO 2070
3240  PRINT ""
3250  FOR S5=1 TO 1000
3260  NEXT S5
3270  R3=0
3280  GOTO 3310
3290  PRINT ""
3300  R3=1
3310  READ #1,1
3320  FOR M7=1 TO W
3330  READ #1;A$
3340  IF R3=1 THEN 3380
3350  IF A$[1,1]#" " THEN 3390
3360  PRINT "'";
3370  GOTO 3390
3380  GOSUB 4770
3390  FOR F=30 TO 1 STEP -1
3400  IF A$[F,F]#" " THEN 3420
3410  NEXT F
3420  PRINT A$[1,F]
3430  NEXT M7
3440  PRINT "450  RETURN 
3460  PRINT "???"
3470  H=0
3480  PRINT "*";
3490  INPUT B$[1,30]
3500  IF B$[1,1]="/" THEN 3520
3510  IF H=1 THEN 3950
3520  IF B$[2,2]#"F" THEN 3540
3530  RETURN 
3540  H=1
3550  IF B$[2,2]="I" THEN 3920
3560  H=2
3570  IF B$[2,2]="S" THEN 4200
3580  IF B$[2,2]#"A" THEN 3460
3590  INPUT S
3600  G1=FNB(S)
3610  FOR K=FNA(S) TO FNA(W)
3620  READ #1,K;A$,B$,D$,E$
3630  IF K=90 THEN 720
3640  READ #1;F$
3650  GOTO G1 OF 3690,3680,3670
3660  E$=D$
3670  D$=B$
3680  B$=A$
3690  PRINT #1,K;B$,D$,E$,F$
3700  G1=1
3710  NEXT K
3720  L=-1
3730  GOSUB 3750
3740  GOTO 3470
3750  IF FNA(Y[J])#FNA(Y[J]+L) THEN 3880
3760  U=FNA(Y[J])+X[J]+1
3770  B=ABS(-L*89 MIN U)
3780  INPUT S
3790  C=ABS(L*90 MIN U)
3800  FOR K=B TO C STEP -L
3810  READ #1,K;A$,B$,E$,F$
3820  PRINT #1,K+L;A$,B$,E$,F$
3830  NEXT K
3840  FOR K=1 TO 9
3850  IF X[K] <= X[J] THEN 3870
3860  X[K]=X[K]+L
3870  NEXT K
3880  Y[J]=Y[J]+L
3890  PRINT #2,1;D$
3900  MAT  PRINT X,Y
3910  RETURN 
3920  A=FNB(S)
3930  PRINT "*";
3940  INPUT B$[1,30]
3950  REM
3960  L=1
3970  GOSUB 3750
3980  FOR K=FNA(S) TO FNA(S+Y[J])
3990  IF K=91 THEN 720
4000  READ #1,K;A$,D$,E$,F$
4010  PRINT #1,K
4020  IF A#1 THEN 4040
4030  GOSUB 4180
4040  PRINT #1;A$
4050  IF A#2 THEN 4070
4060  GOSUB 4180
4070  PRINT #1;D$
4080  IF A#3 THEN 4100
4090  GOSUB 4180
4100  PRINT #1;E$
4110  IF A#4 THEN 4130
4120  GOSUB 4180
4130  B$=F$
4140  A=1
4150  NEXT K
4160  S=S+1
4170  GOTO 3480
4180  PRINT #1;B$
4190  RETURN 
4200  INPUT A$[1,30]
4210  READ #1,FNA(S);B$,D$,E$,F$
4220  GOTO FNB(S) OF 4250,4270,4290
4230  F$=A$
4240  GOTO 4300
4250  B$=A$
4260  GOTO 4300
4270  D$=A$
4280  GOTO 4300
4290  E$=A$
4300  PRINT #1,FNA(S);B$,D$,E$,F$
4310  GOTO 3480
4320  PRINT #2,2
4330  PRINT #2;U
4340  FOR T0=1 TO U
4350  PRINT #2;A[T0]
4360  NEXT T0
4370  RETURN 
4380  READ #2,2
4390  READ #2;U
4400  FOR T0=1 TO U
4410  READ #2;A[T0]
4420  NEXT T0
4430  RETURN 
4440  F=FNA(Y[J])
4450  FOR L=1 TO 9
4460  IF X[L] <= X[J] THEN 4480
4470  X[L]=X[L]-F
4480  NEXT L
4490  FOR L=X[J]+F TO 89
4500  READ #1,L+1;A$,B$,E$,F$
4510  PRINT #1,L-F;A$,B$,E$,F$
4520  NEXT L
4530  D$[6*J-5,6*J]=" "
4540  PRINT #2,1;D$
4550  MAT  PRINT X,Y
4560  RETURN 
4570  RETURN 
4580  C=0
4590  FOR H=1+G TO 30
4600  IF B$[H,H]#"." THEN 4630
4610  X=H+1
4620  GOTO 4680
4630  FOR K=1 TO 10
4640  IF B$[H,H]=C$[K,K] THEN 4670
4650  NEXT K
4660  RETURN 
4670  C=10*C+K-1
4680  NEXT H
4690  RETURN 
4700  FOR G=K2 TO 24
4710  IF B$[G,G]="," THEN 4750
4720  NEXT G
4730  K2=1
4740  RETURN 
4750  K2=G+1
4760  RETURN 
4770  A=INT(M7/100)+1
4780  B=INT(M7/10-10*A)+1
4790  C=M7-100*A-10*B+1
4800  PRINT C$[A,A];C$[B,B];C$[C,C];"  ";
4810  RETURN 
4820  PRINT "FIM DE TAREFA"
4830  END 
