10  REM     *********************************
20  REM     *                               *
30  REM     *    SIMULADOR   ' S I M U '    *
40  REM     *                               *
50  REM     *********************************
60  REM
70  REM ** SIMULA UM COMPUTADOR OPERANDO EM DOS **
80  REM ** ACEITA PROGRAMAS ESCRITOS EM ASSEMBLER **
90  REM ** AUTOR - SEBASTIAO SANTIAGO BARRETTO **
100  REM ** VERSAO 1 * LSD-EPUSP-DEE * 28/9/73 **
110  DEF FNA(X)=INT((X+3)/4)
120  DEF FNB(X)=X-INT((X-1)/4)*4
130  DIM A$[30],B$[30],C$[10],D$[31],E$[30],F$[30]
140  DIM A[360],B[361],X[9]
150  FILES A,B
160  W=0
170  MAT A=ZER
180  MAT B=ZER
190  C$="0123456789"
200  DATA "TA","FI","CA","CH","GU","MU","LI","PE","EX","CO"
210  DATA "CAX","MDX","SOX","SUX","MUX","DIX","ARX"
220  DATA "CAR","ARM","SOM","SUB","MUL","DIV","IMP","IML"
230  DATA "LE ","MDM","DAI","PAR","DC ","NOP","MAD","MAE"
240  DATA "DZ ","DP ","DN ","DO ","D  ","DM ","BIB"
250  DATA "IS ","ABS","EXP","LOG","INT","SQR","RND","SIN","COS","ATN"
260  B0=T=0
270  PRINT "@";
280  INPUT A$
290  IF A$[1,1]=":" THEN 320
300  PRINT "???"
310  GOTO 270
320  FOR I=1 TO 10
330  IF T#0 OR I<3 THEN 360
340  PRINT "IGNORADO"
350  GOTO 450
360  READ B$
370  IF A$[2,3]=B$ THEN 410
380  NEXT I
390  PRINT "COMANDO INCORRETO ; REENTRE-O NOVAMENTE"
400  GOTO 450
410  IF I<5 OR W#0 THEN 440
420  PRINT "NAO EXISTE NENHUM PROGRAMA"
430  GOTO 450
440  GOSUB I OF 470,3890,490,3770,3680,2980,2800,2750,1350,650
450  RESTORE 
460  GOTO 270
470  T=1
480  RETURN 
490  PRINT #1,1
500  W=0
510  INPUT D$[1,31]
520  IF D$[1,1]#"'" THEN 540
530  D$[1,30]=D$[2,31]
540  IF W<360 THEN 570
550  PRINT "PROGRAMA MUITO LONGO"
560  RETURN 
570  PRINT #1;D$[1,30]
580  W=W+1
590  IF D$[5,7]#"FIM" THEN 510
600  IF FNB(W)=4 THEN 640
610  FOR I=FNB(W) TO 3
620  PRINT #1;D$[1,30]
630  NEXT I
640  RETURN 
650  B0=1
660  FOR I=1 TO W-1
670  READ #1,FNA(I)
680  FOR K=1 TO FNB(I)
690  READ #1;B$
700  NEXT K
710  J=L=0
720  IF B$[1,1]="*" THEN 1270
730  FOR J=1 TO 30
740  READ A$
750  IF A$=B$[5,7] THEN 810
760  NEXT J
770  C0=1
780  PRINT "ERRO";C0;"NA INSTRUCAO";I
790  B0=J=0
800  GOTO 1270
810  IF J=29 THEN 1270
820  IF J#30 THEN 900
830  FOR L=1 TO 10
840  READ A$
850  IF B$[12,14]=A$ THEN 1270
860  NEXT L
870  L=0
880  C0=3
890  GOTO 780
900  FOR B=2 TO 10
910  IF B$[10,10]=C$[B,B] THEN 960
920  NEXT B
930  B=1
940  C0=4
950  IF J<8 THEN 780
960  J=J+100*(B-1)
970  IF B$[9,9]#"I" THEN 990
980  J=-J
990  G=12
1000  X=31
1010  V=-1
1020  IF B$[G,G]="-" THEN 1050
1030  V=1
1040  IF B$[G,G]#"+" THEN 1190
1050  FOR H=1+G TO 30
1060  IF B$[H,H]=" " THEN 1150
1070  IF B$[H,H]#"." THEN 1100
1080  X=H+1
1090  GOTO 1140
1100  FOR K=1 TO 10
1110  IF B$[H,H]=C$[K,K] THEN 1130
1120  NEXT K
1130  L=10*L+K-1
1140  NEXT H
1150  L=L*V
1160  IF X>H THEN 1270
1170  L=L/10^(H-X)
1180  GOTO 1270
1190  IF B$[12,14]="   " THEN 1270
1200  READ #1,1
1210  FOR L=1 TO W-1
1220  READ #1;A$
1230  IF A$[1,3]=B$[12,14] THEN 1270
1240  NEXT L
1250  C0=2
1260  GOTO 780
1270  A[I]=J
1280  B[I]=L
1290  RESTORE 210
1300  NEXT I
1310  IF B0=0 THEN 1330
1320  PRINT "NENHUM ERRO"
1330  PRINT "FIM DA COMPILACAO"
1340  RETURN 
1350  IF B0=1 THEN 1400
1360  PRINT "EXECUCAO IMPOSSIVEL"
1370  RETURN 
1380  E0=2
1390  GOTO 1450
1400  A=O=0
1410  MAT X=ZER
1420  I1=1
1430  IF I1<W AND I1>0 THEN 1490
1440  E0=1
1450  PRINT "ERRO";E0;"EXECUCAO SUSPENSA"
1460  RETURN 
1470  PRINT "FIM DA EXECUCAO"
1480  RETURN 
1490  IF A[I1]=0 THEN 1690
1500  B=B[I1]
1510  A2=ABS(A[I1])
1520  I5=INT(A2/100)
1530  A5=A2-100*I5
1540  IF A5>6 OR A5<3 THEN 1570
1550  B=361
1560  B[361]=X[I5]
1570  IF I5=0 OR A5<8 THEN 1590
1580  B=B+X[I5]
1590  IF A[I1] >= 0 THEN 1620
1600  IF B<1 OR B >= W THEN 1440
1610  B=B[B]
1620  GOTO A5 OF 2190,2230,1880,1920,2090,2130
1630  IF B<1 OR B >= W THEN 1660
1640  GOTO A5-6 OF 2210,1710,1730,1880,1920,2090
1650  GOTO A5-12 OF 2130,1960,1980,2000,2020,2060
1660  GOTO A5-18 OF 1470,1380,1690,2350,2300,1750
1670  GOTO A5-24 OF 1780,1810,1840,1820,2400,2500
1680  GOTO 1440
1690  I1=I1+1
1700  GOTO 1430
1710  A=B[B]
1720  GOTO 1690
1730  B[B]=A
1740  GOTO 1690
1750  IF A#0 THEN 1690
1760  I1=B-1
1770  GOTO 1690
1780  IF A <= 0 THEN 1690
1790  I1=B-1
1800  GOTO 1690
1810  IF A >= 0 THEN 1690
1820  I1=B-1
1830  GOTO 1690
1840  IF O=0 THEN 1690
1850  I1=B-1
1860  O=0
1870  GOTO 1690
1880  A=A+B[B]
1890  IF ABS(A)<10^6 THEN 1690
1900  O=1
1910  GOTO 1690
1920  A=A-B[B]
1930  GOTO 1890
1940  O=1
1950  GOTO 1690
1960  PRINT B[B]
1970  GOTO 1690
1980  PRINT B[B];
1990  GOTO 1690
2000  INPUT B[B]
2010  GOTO 1690
2020  B[B]=B[B]-1
2030  IF B[B]#0 THEN 1690
2040  I1=I1+1
2050  GOTO 1690
2060  B[B]=I1
2070  I1=B
2080  GOTO 1690
2090  A=A*B[B]
2100  GOTO 1890
2110  O=1
2120  GOTO 1690
2130  IF B[B]#0 THEN 2170
2140  A=SGN(A)*10^38
2150  PRINT "DIVISAO POR ZERO"
2160  GOTO 1900
2170  A=A/B[B]
2180  GOTO 1890
2190  X[I5]=B
2200  GOTO 1690
2210  B[B]=X[I5]
2220  GOTO 1690
2230  L6=X[I5]+B
2240  IF X[I5]=0 OR SGN(X[I5])=SGN(L6) THEN 2260
2250  I1=I1+1
2260  X[I5]=L6
2270  GOTO 1690
2280  A=-A
2290  GOTO 1690
2300  IF B <= 0 THEN 1690
2310  FOR F2=1 TO B
2320  A=INT(A/10)
2330  NEXT F2
2340  GOTO 1690
2350  IF B <= 0 THEN 1690
2360  FOR F2=1 TO B
2370  A=10*(A-INT(A/100000.)*100000.)
2380  NEXT F2
2390  GOTO 1690
2400  GOSUB 3820
2410  FOR K7=12 TO 30
2420  IF A$[K7,K7]#"'" THEN 2470
2430  IF K7=30 THEN 1690
2440  IF A$[K7+1,K7+1]#"'" THEN 1690
2450  PRINT 
2460  GOTO 1690
2470  PRINT A$[K7,K7];
2480  NEXT K7
2490  GOTO 1690
2500  GOTO B OF 2530,2550,2570,2590,2630,2650,2690,2710,2730
2510  A=ATN(A)
2520  GOTO 1690
2530  A=-A
2540  GOTO 1690
2550  A=ABS(A)
2560  GOTO 1690
2570  A=EXP(A)
2580  GOTO 1690
2590  E0=3
2600  IF A <= 0 THEN 1450
2610  A=LOG(A)
2620  GOTO 1690
2630  A=INT(A)
2640  GOTO 1690
2650  E0=4
2660  IF A<0 THEN 1450
2670  A=SQR(A)
2680  GOTO 1690
2690  A=RND(0)
2700  GOTO 1690
2710  A=SIN(A)
2720  GOTO 1690
2730  A=COS(A)
2740  GOTO 1690
2750  PRINT ""
2760  FOR S5=1 TO 1000
2770  NEXT S5
2780  R3=0
2790  GOTO 2820
2800  PRINT ""
2810  R3=1
2820  READ #1,1
2830  FOR M7=1 TO W
2840  READ #1;A$
2850  IF R3=1 THEN 2890
2860  IF A$[1,1]#" " THEN 2900
2870  PRINT "'";
2880  GOTO 2900
2890  PRINT "LINHA";M7;
2900  FOR F=30 TO 1 STEP -1
2910  IF A$[F,F]#" " THEN 2930
2920  NEXT F
2930  PRINT A$[1,F]
2940  NEXT M7
2950  PRINT ""
2960  RETURN 
2970  PRINT "???"
2980  H=0
2990  PRINT "*";
3000  INPUT B$[1,30]
3010  IF B$[1,1]="/" THEN 3030
3020  IF H=1 THEN 3330
3030  IF B$[2,2]#"F" THEN 3050
3040  RETURN 
3050  H=1
3060  IF B$[2,2]="I" THEN 3300
3070  H=2
3080  IF B$[2,2]="S" THEN 3250
3090  IF B$[2,2]#"A" THEN 2970
3100  INPUT S
3110  G1=FNB(S)
3120  FOR K=FNA(S) TO FNA(W)
3130  READ #1,K;A$,B$,D$,E$
3140  IF K=90 THEN 550
3150  READ #1;F$
3160  GOTO G1 OF 3200,3190,3180
3170  E$=D$
3180  D$=B$
3190  B$=A$
3200  PRINT #1,K;B$,D$,E$,F$
3210  G1=1
3220  NEXT K
3230  W=W-1
3240  GOTO 2980
3250  INPUT S
3260  PRINT "*";
3270  INPUT A$[1,30]
3280  GOSUB 3570
3290  GOTO 2990
3300  INPUT X1
3310  PRINT "*";
3320  INPUT B$[1,30]
3330  S=FNB(X1)
3340  W=W+1
3350  FOR K=FNA(X1) TO FNA(W)
3360  IF K=91 THEN 550
3370  READ #1,K;A$,D$,E$,F$
3380  PRINT #1,K
3390  IF S#1 THEN 3410
3400  GOSUB 3550
3410  PRINT #1;A$
3420  IF S#2 THEN 3440
3430  GOSUB 3550
3440  PRINT #1;D$
3450  IF S#3 THEN 3470
3460  GOSUB 3550
3470  PRINT #1;E$
3480  IF S#4 THEN 3500
3490  GOSUB 3550
3500  B$=F$
3510  S=1
3520  NEXT K
3530  X1=X1+1
3540  GOTO 2990
3550  PRINT #1;B$
3560  RETURN 
3570  READ #1,FNA(S);B$,D$,E$,F$
3580  GOTO FNB(S) OF 3610,3630,3650
3590  F$=A$
3600  GOTO 3660
3610  B$=A$
3620  GOTO 3660
3630  D$=A$
3640  GOTO 3660
3650  E$=A$
3660  PRINT #1,FNA(S);B$,D$,E$,F$
3670  RETURN 
3680  PRINT #2,1
3690  PRINT #2;W
3700  FOR T0=1 TO W-1
3710  PRINT #2;A[T0]
3720  NEXT T0
3730  FOR T0=1 TO W-1
3740  PRINT #2;B[T0]
3750  NEXT T0
3760  RETURN 
3770  READ #2,1
3780  READ #2;W
3790  MAT  READ #2;A[W-1]
3800  MAT  READ #2;B[W-1]
3810  RETURN 
3820  READ #1,1
3830  IF I1#0 THEN 3850
3840  RETURN 
3850  FOR K7=1 TO I1
3860  READ #1;A$
3870  NEXT K7
3880  RETURN 
3890  END 
